# Linux based PSI/SI Gen and Anly


CEXTRAFLAGS = -DDVBPSI_DIST

CINC = -I ./include
CLINC =

SCR_INC = 
SCR_LINC =

CFLAGS = -O2 -g -I/home/ishare/src/snapgear/linux-2.4.x/include -I/home/ishare/src/snapgear/lib/uClibc/include $(CINC)


DESCRIPTOR_SRC =  descriptors/dr_02.c \
                  descriptors/dr_03.c \
                  descriptors/dr_04.c \
                  descriptors/dr_05.c \
                  descriptors/dr_06.c \
                  descriptors/dr_07.c \
                  descriptors/dr_08.c \
                  descriptors/dr_09.c \
                  descriptors/dr_0a.c \
                  descriptors/dr_0b.c \
                  descriptors/dr_0c.c \
                  descriptors/dr_0d.c \
                  descriptors/dr_0e.c \
                  descriptors/dr_0f.c \
                  descriptors/dr_42.c \
                  descriptors/dr_47.c \
                  descriptors/dr_48.c \
                  descriptors/dr_59.c

DESCRIPTOR_OBJ =  descriptors/dr_02.o \
                  descriptors/dr_03.o \
                  descriptors/dr_04.o \
                  descriptors/dr_05.o \
                  descriptors/dr_06.o \
                  descriptors/dr_07.o \
                  descriptors/dr_08.o \
                  descriptors/dr_09.o \
                  descriptors/dr_0a.o \
                  descriptors/dr_0b.o \
                  descriptors/dr_0c.o \
                  descriptors/dr_0d.o \
                  descriptors/dr_0e.o \
                  descriptors/dr_0f.o \
                  descriptors/dr_42.o \
                  descriptors/dr_47.o \
                  descriptors/dr_48.o \
                  descriptors/dr_59.o

TABLE_SRC  =   	tables/pat.c  \
               	tables/pmt.c  \
	       	tables/sdt.c  \
		tables/cat.c  \
		tables/nit.c  \
		tables/eit.c  

TABLE_OBJ  =   	tables/pat.o  \
               	tables/pmt.o  \
	       	tables/sdt.o  \
		tables/cat.o  \
		tables/nit.o  \
		tables/eit.o

PSI_SRC  =   psi/descriptor.c  	 \
             psi/demux.c  	 \
	     psi/dvbpsi.c        \
             psi/psi.c           \
	     psi/gen_dvb_si.c

PSI_OBJ  =   psi/descriptor.o  	 \
             psi/demux.o  	 \
	     psi/dvbpsi.o        \
             psi/psi.o           \
	     psi/gen_dvb_si.o

SRCS = ${DESCRIPTOR_SRC} ${TABLE_SRC}  ${PSI_SRC}
SRCS_OBJ = ${DESCRIPTOR_OBJ} ${TABLE_OBJ}  ${PSI_OBJ}

APP_DPAT = examples/decode_pat.c
APP_EXE_DPAT = decode_pat
${APP_EXE_DPAT}: ${SRCS} 
	$(CC) $(LDFLAGS) -lc  ${CEXTRAFLAGS} ${CINC} -o ${APP_EXE_DPAT} ${APP_DPAT} ${SRCS}
 
APP_DPMT = examples/decode_pmt.c
APP_EXE_DPMT = decode_pmt
${APP_EXE_DPMT}: ${SRCS} 
	$(CC) $(LDFLAGS) -lc  ${CEXTRAFLAGS} ${CINC} -o ${APP_EXE_DPMT} ${APP_DPMT} ${SRCS} 

APP_DSDT = examples/decode_sdt.c
APP_EXE_DSDT = decode_sdt
${APP_EXE_DSDT}: ${SRCS} 
	$(CC) $(LDFLAGS) -lc  ${CEXTRAFLAGS} ${CINC} -o ${APP_EXE_DSDT} ${APP_DSDT} ${SRCS} 
	
APP_GPAT = examples/gen_pat.c
APP_EXE_GPAT = gen_pat
${APP_EXE_GPAT}: ${SRCS} 
	$(CC) $(LDFLAGS) -lc  ${CEXTRAFLAGS} ${CINC} -o ${APP_EXE_GPAT} ${APP_GPAT} ${SRCS} 	
	
APP_GPMT = examples/gen_pmt.c
APP_EXE_GPMT = gen_pmt
${APP_EXE_GPMT}: ${SRCS} 
	$(CC) $(LDFLAGS) -lc  ${CEXTRAFLAGS} ${CINC} -o ${APP_EXE_GPMT} ${APP_GPMT} ${SRCS} 	

APP_GCRC = examples/gen_crc.c
APP_EXE_GCRC = gen_crc
${APP_EXE_GCRC}: ${SRCS} 
	$(CC) $(LDFLAGS) -lc  ${CEXTRAFLAGS} ${CINC} -o ${APP_EXE_GCRC} ${APP_GCRC} ${SRCS} 
	
APP_TEST_DR = examples/test.c
APP_EXE_TEST_DR = test
${APP_EXE_TEST_DR}: ${SRCS} 
	$(CC) $(LDFLAGS) -lc  ${CEXTRAFLAGS} ${CINC} -o ${APP_EXE_TEST_DR} ${APP_TEST_DR} ${SRCS} 

LIB_UVPSI = libuvpsi.a
$(LIB_UVPSI): $(SRCS_OBJ)
	$(AR) rc $@ $^
	
all: ${APP_EXE_DPAT} ${APP_EXE_DPMT} ${APP_EXE_DSDT} 		\
			${APP_EXE_GPAT} ${APP_EXE_GPMT} ${APP_EXE_GCRC}		\
			 ${APP_EXE_TEST_DR} \
			${LIB_UVPSI}

clean:
	rm -fr *.o *.lo
	rm -fr *.a *.la
	rm -fr *.so  *.gdb 
	rm -fr ${APP_EXE_DPAT} ${APP_EXE_DPMT} ${APP_EXE_DSDT} 		\
			${APP_EXE_GPAT} ${APP_EXE_GPMT} ${APP_EXE_GCRC}		\
			 ${APP_EXE_TEST_DR}
	find . -name "*.o" | xargs rm -f

 
